name: Java CI with Ant

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Set up JDK 11
      uses: actions/setup-java@v3
      with:
        java-version: '11'
        distribution: 'temurin'
        cache: 'ant'

    - name: Verify Java installation
      run: |
        java -version
        javac -version

    - name: Check project structure
      run: |
        echo "Project structure:"
        find . -type f -name "*.java" | head -20
        echo ""
        ls -la

    - name: Create build.xml if missing
      run: |
        if [ ! -f "build.xml" ]; then
          cat > build.xml << 'EOF'
        <?xml version="1.0" encoding="UTF-8"?>
        <project name="NetworkSubnettingAutomation" default="compile" basedir=".">
          <property name="src.dir" value="."/>
          <property name="build.dir" value="build"/>
          
          <target name="init">
            <mkdir dir="${build.dir}"/>
          </target>
          
          <target name="compile" depends="init">
            <javac srcdir="${src.dir}" destdir="${build.dir}" includeantruntime="false">
              <include name="networksubnettingautomation/*.java"/>
            </javac>
          </target>
          
          <target name="clean">
            <delete dir="${build.dir}"/>
          </target>
        </project>
        EOF
          echo "Created build.xml file"
        fi

    - name: Run Ant build
      run: ant compile

    - name: Test compilation
      run: |
        # Test if classes were compiled
        if [ -d "build" ]; then
          echo "Compilation successful! Classes found in build directory."
          find build -name "*.class" | wc -l | xargs echo "Number of .class files:"
        else
          echo "ERROR: Build directory not created!"
          exit 1
        fi
